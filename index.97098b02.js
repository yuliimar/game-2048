var t,e={};const s=new((t=class{constructor(t){this.state=t||this.getEmptyBoard(),this.score=0,this.status="idle"}getEmptyBoard(){return[,,,,].fill(null).map(()=>[,,,,].fill(0))}getScore(){return this.score}getState(){return this.state.map(t=>[...t])}getStatus(){return this.status}start(){"idle"===this.status&&(this.status="playing",this.addRandomTile(),this.addRandomTile())}restart(){this.state=this.getEmptyBoard(),this.score=0,this.status="idle"}addRandomTile(){let t=[];if(this.state.forEach((e,s)=>{e.forEach((e,a)=>{0===e&&t.push({y:s,x:a})})}),t.length>0){let{y:e,x:s}=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}}moveLeft(){if("playing"!==this.status)return!1;let t=!1,e=this.state.map(t=>{let e=t.filter(t=>0!==t);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e[t+1]=0);for(e=e.filter(t=>0!==t);e.length<4;)e.push(0);return e});return JSON.stringify(this.state)!==JSON.stringify(e)&&(this.state=e,this.addRandomTile(),t=!0),this.checkGameStatus(),t}moveRight(){if("playing"!==this.status)return!1;let t=!1,e=this.state.map(t=>{let e=t.filter(t=>0!==t).reverse();for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e[t+1]=0);for(e=e.filter(t=>0!==t);e.length<4;)e.push(0);return e.reverse()});return JSON.stringify(this.state)!==JSON.stringify(e)&&(this.state=e,this.addRandomTile(),t=!0),this.checkGameStatus(),t}moveUp(){if("playing"!==this.status)return!1;let t=!1,e=this.getEmptyBoard();for(let t=0;t<4;t++){let s=[];for(let e=0;e<4;e++)0!==this.state[e][t]&&s.push(this.state[e][t]);for(let t=0;t<s.length-1;t++)s[t]===s[t+1]&&(s[t]*=2,this.score+=s[t],s[t+1]=0);for(s=s.filter(t=>0!==t);s.length<4;)s.push(0);for(let a=0;a<4;a++)e[a][t]=s[a]}return JSON.stringify(this.state)!==JSON.stringify(e)&&(this.state=e,this.addRandomTile(),t=!0),this.checkGameStatus(),t}moveDown(){if("playing"!==this.status)return!1;let t=!1,e=this.getEmptyBoard();for(let t=0;t<4;t++){let s=[];for(let e=3;e>=0;e--)0!==this.state[e][t]&&s.push(this.state[e][t]);for(let t=0;t<s.length-1;t++)s[t]===s[t+1]&&(s[t]*=2,this.score+=s[t],s[t+1]=0);for(s=s.filter(t=>0!==t);s.length<4;)s.push(0);for(let a=0;a<4;a++)e[3-a][t]=s[a]}return JSON.stringify(this.state)!==JSON.stringify(e)&&(this.state=e,this.addRandomTile(),t=!0),this.checkGameStatus(),t}checkGameStatus(){if(this.state.some(t=>t.includes(2048))){this.status="win";return}this.hasAvailableMoves()||(this.status="lose")}hasAvailableMoves(){if(this.state.some(t=>t.includes(0)))return!0;for(let t=0;t<4;t++)for(let e=0;e<3;e++)if(this.state[t][e]===this.state[t][e+1])return!0;for(let t=0;t<4;t++)for(let e=0;e<3;e++)if(this.state[e][t]===this.state[e+1][t])return!0;return!1}}).__esModule?t.default:t),a=document.querySelector(".button.start"),r=document.querySelector(".game-score"),i=document.querySelectorAll(".field-cell"),l=document.querySelector(".message-start"),o=document.querySelector(".message-win"),h=document.querySelector(".message-lose");let n=s.getState();function u(){let t=s.getState();t.forEach((t,e)=>{t.forEach((t,s)=>{let a=i[4*e+s],r=n[e][s];a.textContent=t||"",a.className=`field-cell${t?` field-cell--${t}`:""}`,t!==r&&(a.classList.add("appear"),setTimeout(()=>{a.classList.remove("appear")},150))})}),n=t.map(t=>[...t]),r.textContent=s.getScore(),l.classList.toggle("hidden","idle"!==s.getStatus()),o.classList.toggle("hidden","win"!==s.getStatus()),h.classList.toggle("hidden","lose"!==s.getStatus()),a.textContent="idle"===s.getStatus()?"Start":"Restart",a.className=`button ${"idle"===s.getStatus()?"start":"restart"}`}a.addEventListener("click",()=>{"idle"===s.getStatus()?s.start():s.restart(),u()}),document.addEventListener("keydown",t=>{if("playing"===s.getStatus()){switch(t.key){case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown();break;default:return}u()}}),u();
//# sourceMappingURL=index.97098b02.js.map
